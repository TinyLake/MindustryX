From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: way-zer <himc.wicp@gmail.com>
Date: Thu, 3 Jul 2025 22:45:51 +0800
Subject: [PATCH] H MetricCollector.handleException

---
 core/src/mindustry/net/CrashHandler.java | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/core/src/mindustry/net/CrashHandler.java b/core/src/mindustry/net/CrashHandler.java
index 16e0456c23a999db056f7645ce25dfa737653b34..63ab8bf826b11a2b7713bff8c9706b9548c4e74e 100644
--- a/core/src/mindustry/net/CrashHandler.java
+++ b/core/src/mindustry/net/CrashHandler.java
@@ -9,6 +9,7 @@ import arc.util.io.*;
 import mindustry.*;
 import mindustry.core.*;
 import mindustry.mod.Mods.*;
+import mindustryX.features.*;
 
 import java.io.*;
 import java.text.*;
@@ -20,6 +21,8 @@ import static mindustry.Vars.*;
 public class CrashHandler{
 
     public static String createReport(Throwable exception){
+        MetricCollector.INSTANCE.handleException(exception);
+
         String error = writeException(exception);
         LoadedMod cause = getModCause(exception);
 
@@ -49,6 +52,7 @@ public class CrashHandler{
         try{
             Core.settings.getDataDirectory().child("crashes").child("crash_" + System.currentTimeMillis() + ".txt")
             .writeString(createReport(exception));
+            MetricCollector.INSTANCE.waitPost();//MDTX:Wait before exiting.
         }catch(Throwable ignored){
         }
     }
@@ -113,6 +117,7 @@ public class CrashHandler{
             death.printStackTrace();
         }
 
+        MetricCollector.INSTANCE.waitPost();//MDTX:Wait before exiting.
         System.exit(1);
     }
 
