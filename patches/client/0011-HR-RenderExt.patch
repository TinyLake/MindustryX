From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: way-zer <himc.wicp@gmail.com>
Date: Tue, 26 Mar 2024 19:22:00 +0800
Subject: [PATCH] HR: RenderExt

---
 core/src/mindustry/core/Renderer.java          | 3 ++-
 core/src/mindustry/graphics/BlockRenderer.java | 3 ++-
 core/src/mindustry/input/InputHandler.java     | 5 +++++
 3 files changed, 9 insertions(+), 2 deletions(-)

diff --git a/core/src/mindustry/core/Renderer.java b/core/src/mindustry/core/Renderer.java
index 4bbb531666aad6202c6a97660d65c2996900fb48..b8f9741948892d72519fbb8939f55391aa7e5419 100644
--- a/core/src/mindustry/core/Renderer.java
+++ b/core/src/mindustry/core/Renderer.java
@@ -20,6 +20,7 @@ import mindustry.graphics.g3d.*;
 import mindustry.maps.*;
 import mindustry.type.*;
 import mindustry.world.blocks.*;
+import mindustryX.features.*;
 
 import static arc.Core.*;
 import static mindustry.Vars.*;
@@ -413,7 +414,7 @@ public class Renderer implements ApplicationListener{
         Events.fire(Trigger.drawOver);
         blocks.drawBlocks();
 
-        Groups.draw.draw(Drawc::draw);
+        Groups.draw.draw(RenderExt::onGroupDraw);
 
         if(drawDebugHitboxes){
             DebugCollisionRenderer.draw();
diff --git a/core/src/mindustry/graphics/BlockRenderer.java b/core/src/mindustry/graphics/BlockRenderer.java
index d39cfd9797a5eff99cbca49847776f1eda96108a..e8aa2b654249f2f0d0c78c8400afa62c83a9109d 100644
--- a/core/src/mindustry/graphics/BlockRenderer.java
+++ b/core/src/mindustry/graphics/BlockRenderer.java
@@ -19,6 +19,7 @@ import mindustry.world.*;
 import mindustry.world.blocks.environment.*;
 import mindustry.world.blocks.environment.Floor.*;
 import mindustry.world.blocks.power.*;
+import mindustryX.features.*;
 
 import static arc.Core.*;
 import static mindustry.Vars.*;
@@ -479,7 +480,7 @@ public class BlockRenderer{
 
             //comment wasVisible part for hiding?
             if(block != Blocks.air && (visible || build.wasVisible)){
-                block.drawBase(tile);
+                RenderExt.onBlockDraw(tile, block, build);
                 Draw.reset();
                 Draw.z(Layer.block);
 
diff --git a/core/src/mindustry/input/InputHandler.java b/core/src/mindustry/input/InputHandler.java
index 68bb108c22a0a4eae1369c7bf2ec37d1ad646e75..7d127c1a88a3256b90855b764209e09b4acf7286 100644
--- a/core/src/mindustry/input/InputHandler.java
+++ b/core/src/mindustry/input/InputHandler.java
@@ -342,6 +342,11 @@ public abstract class InputHandler implements InputProcessor, GestureListener{
                         ai.group = null;
                     }
 
+                    //remove when other player command
+                    if(!headless && player != Vars.player){
+                        if(control.input.selectedUnits.contains(unit)) RenderExt.onRtsRemoveUnit(player, unit);
+                    }
+
                     toAdd.add(unit);
                 }
             }
